<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ชีทสรุปคำศัพท์</title>
    <style>
        body {
            font-family: 'Inter', Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
            max-width: 600px;
            margin: 20px auto;
            color: #333;
            background-color: #f7f7f7;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* หัวข้อหลัก */
        .header-section {
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea; /* สีม่วงน้ำเงิน */
            margin-bottom: 25px;
        }

        .header-section h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 0px;
            color: #4a5568;
        }
        .header-section p {
            font-size: 18px;
            margin-top: 5px;
            color: #718096;
            font-weight: 500;
        }

        /* รายการคำศัพท์แต่ละคำ */
        .vocabulary-item {
            margin-bottom: 25px;
            background-color: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            transition: transform 0.2s;
        }

        .vocabulary-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        /* คำศัพท์หลัก */
        .word-title {
            font-size: 22px;
            font-weight: 800;
            color: #2d3748; /* สีเข้ม */
            margin-bottom: 5px;
        }
        
        /* คำอ่าน */
        .pronunciation {
            font-size: 16px;
            color: #d53f8c; /* สีชมพู */
            margin-bottom: 10px;
        }
        
        /* ความหมาย */
        .meaning {
            font-size: 18px;
            font-weight: 600;
            color: #48bb78; /* สีเขียว */
            margin-bottom: 15px;
        }

        /* ประโยคตัวอย่าง (อังกฤษ) */
        .example {
            font-style: italic;
            margin-bottom: 4px;
            font-size: 16px;
            color: #2b6cb0; /* สีน้ำเงิน */
        }
        /* ประโยคตัวอย่าง (ไทย) */
        .example-thai {
            font-style: normal;
            font-size: 14px;
            color: #718096;
            margin-bottom: 10px;
            margin-top: 0;
            padding-left: 10px; /* ย่อหน้าเล็กน้อย */
            border-left: 2px solid #e9d8fd;
        }

        /* สไตล์สำหรับ Loading */
        .loading-text {
            text-align: center;
            font-size: 1.2rem;
            color: #718096;
            margin-top: 40px;
        }

        /* สไตล์สำหรับปุ่มสร้าง PDF */
        .print-button-container {
            text-align: center;
            margin-bottom: 25px;
        }
        #printPdfButton {
            padding: 10px 20px;
            background-color: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            font-weight: bold;
        }
        #printPdfButton:hover {
            background-color: #5a67d8;
            transform: translateY(-1px);
        }

        /* ************************************** */
        /* สไตล์สำหรับพิมพ์ (Print Styles) */
        /* ************************************** */
        @media print {
            /* 1. รีเซ็ตพื้นหลังและเงาของ Body */
            body {
                background-color: white !important;
                box-shadow: none !important;
                margin: 0;
                max-width: none;
                padding: 0;
                color: black !important;
            }

            /* 2. ซ่อนปุ่มและองค์ประกอบที่ไม่ต้องการพิมพ์ */
            .print-button-container, .loading-text {
                display: none;
            }

            /* 3. ปรับสไตล์ส่วนหัวให้เป็นสีดำ */
            .header-section {
                border-bottom: 1px solid black !important;
                padding-bottom: 10px;
                margin-bottom: 15px;
            }
            .header-section h1, .header-section p {
                 color: black !important;
            }
            
            /* 4. ปรับสไตล์รายการคำศัพท์ให้เหมาะสมกับการพิมพ์ */
            .vocabulary-item {
                margin-bottom: 15px;
                background-color: white;
                border: none; /* ลบ border เดิม */
                border-bottom: 1px dashed #ccc; /* ใช้เส้นประแบ่งแทน */
                box-shadow: none; /* ลบเงา */
                padding: 0;
            }
            .vocabulary-item:hover {
                transform: none;
            }

            /* 5. บังคับให้ข้อความเป็นสีดำทั้งหมด */
            .word-title, .pronunciation, .meaning, .example, .example-thai {
                color: black !important;
                font-weight: normal !important;
            }
            .word-title {
                 font-weight: bold !important;
            }
            .example-thai {
                border-left: none !important;
                padding-left: 0;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- ส่วนหัวข้อหลัก -->
    <div class="header-section">
        <h1>Family and relationships</h1>
        <p>ครอบครัว และความสัมพันธ์ (ดึงข้อมูลจาก Google Sheet)</p>
    </div>

    <!-- ปุ่มสร้าง PDF -->
    <div class="print-button-container">
        <button id="printPdfButton">สร้าง PDF/พิมพ์ชีทสรุป</button>
    </div>

    <!-- ส่วนที่จะแสดงคำศัพท์ที่ดึงมาจาก Google Sheet -->
    <div id="vocabulary-content">
        <p class="loading-text">กำลังโหลดคำศัพท์...</p>
    </div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR_jkPuMWbwUrIzyF4FKmBcXWxsdP2mogpDgsOTAjq-ElihbTs9tCy6GyghVaTCAUadbi6KTxUy0arO/pub?gid=331265533&single=true&output=csv';
        const VOCAB_CONTAINER_ID = 'vocabulary-content';
        
        // ชื่อคอลัมน์ที่กำหนดโดยผู้ใช้
        const HEADERS = [
            'word_name', 
            'word_ipa', 
            'word_meaning', 
            'word_sen1', 
            'word_sentr1', 
            'word_sen2', 
            'word_sentr2'
        ];

        // ฟังก์ชันสำหรับแยกวิเคราะห์ข้อมูล CSV เป็นอาร์เรย์ของวัตถุ
        function parseCSV(csvText) {
            // แยกบรรทัด (ใช้ regex เพื่อจัดการกับ newline ทั้งแบบ \r\n และ \n)
            const lines = csvText.trim().split(/\r?\n/);
            
            // ข้ามบรรทัดแรกที่เป็น Header ของ Google Sheet (ถ้ามี)
            const dataLines = lines.slice(1); 
            
            const data = [];
            dataLines.forEach(line => {
                // แยกค่าด้วยเครื่องหมายคอมมาตรงๆ
                const values = line.split(','); 

                // ตรวจสอบว่ามีข้อมูลและจำนวนคอลัมน์ตรงกัน
                if (values && values.length === HEADERS.length) {
                    const entry = {};
                    values.forEach((value, i) => {
                        // ลบเครื่องหมายคำพูดคู่ที่อาจมีออก และ trim ช่องว่าง
                        entry[HEADERS[i]] = value.replace(/^"|"$/g, '').trim();
                    });
                    data.push(entry);
                }
            });
            return data;
        }

        // ฟังก์ชันสำหรับสร้าง HTML และแสดงผล
        function renderVocabulary(vocabularyData) {
            const container = document.getElementById(VOCAB_CONTAINER_ID);
            if (!container) return;

            // ล้างเนื้อหาเดิม (Loading text)
            container.innerHTML = '';
            
            let htmlContent = '';
            
            vocabularyData.forEach(item => {
                // สร้าง HTML สำหรับคำศัพท์แต่ละรายการ
                htmlContent += `
                    <div class="vocabulary-item">
                        <div class="word-title">${item.word_name || ''}</div>
                        <div class="pronunciation">${item.word_ipa ? `/ ${item.word_ipa} /` : ''}</div>
                        <div class="meaning">${item.word_meaning || ''}</div>
                        
                        ${item.word_sen1 ? `<div class="example">${item.word_sen1}</div>` : ''}
                        ${item.word_sentr1 ? `<p class="example-thai">(${item.word_sentr1})</p>` : ''}
                        
                        ${item.word_sen2 ? `<div class="example">${item.word_sen2}</div>` : ''}
                        ${item.word_sentr2 ? `<p class="example-thai">(${item.word_sentr2})</p>` : ''}
                    </div>
                `;
            });

            // ตรวจสอบว่ามีข้อมูลหรือไม่
            if (vocabularyData.length === 0) {
                htmlContent = '<p class="loading-text" style="color: #e53e3e;">ไม่พบคำศัพท์ใน Google Sheet หรือรูปแบบข้อมูลไม่ถูกต้อง</p>';
            }

            // แทรก HTML เข้าไปใน DOM
            container.innerHTML = htmlContent;
        }

        // ฟังก์ชันหลักในการดึงข้อมูล
        async function fetchAndRenderVocabulary() {
            try {
                const response = await fetch(CSV_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvText = await response.text();
                
                const vocabularyData = parseCSV(csvText);
                
                renderVocabulary(vocabularyData);

            } catch (error) {
                console.error("Error fetching or parsing CSV:", error);
                const container = document.getElementById(VOCAB_CONTAINER_ID);
                if (container) {
                    container.innerHTML = `<p class="loading-text" style="color: #e53e3e;">เกิดข้อผิดพลาดในการโหลดข้อมูล: ${error.message}</p>`;
                }
            }
        }

        // ใช้ DOMContentLoaded เพื่อให้แน่ใจว่าปุ่มพร้อมใช้งานทันที
        document.addEventListener('DOMContentLoaded', function() {
            // ตั้งค่าปุ่มสร้าง PDF/พิมพ์
            const printButton = document.getElementById('printPdfButton');
            if (printButton) {
                printButton.addEventListener('click', () => {
                    // ใช้ฟังก์ชันพิมพ์ของเบราว์เซอร์
                    window.print(); 
                });
            }
            // เริ่มดึงข้อมูล
            fetchAndRenderVocabulary();
        });

    </script>
</body>
</html>
